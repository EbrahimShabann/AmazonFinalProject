@model Final_project.Models.order

@{
    ViewData["Title"] = "Order Details";
    var sellerId = User.Identity.Name ?? "test-seller-id";
}

@section Styles {
    <style>
        .order-details-section p strong {
            color: #1976d2;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        .order-details-section p {
            color: #333;
            font-size: 1.08rem;
        }
        .seller-info-box {
            transition: box-shadow 0.2s;
        }
        .seller-info-box:hover {
            box-shadow: 0 4px 18px #1976d222, 0 1.5px 4px #0001;
        }
    </style>
}

<h2>Order Details</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}
<div class="card mb-3 order-details-section">
    <div class="card-body">
        <h5>Order ID: <span class="badge bg-primary">@Model.id</span></h5>
        <p><strong>Date:</strong> @Model.order_date?.ToString("yyyy-MM-dd")</p>
        <p><strong>Customer:</strong> @Model.Buyer?.UserName</p>
        <p><strong>Status:</strong> 
            <span class="badge" style="font-size:1em;padding:7px 16px;border-radius:8px;letter-spacing:0.5px;
                background:@(Model.status == "Pending" ? "#ffc107" : Model.status == "Processing" ? "#0dcaf0" : Model.status == "Shipped" ? "#0d6efd" : Model.status == "Delivered" ? "#198754" : Model.status == "Cancelled" ? "#dc3545" : "#adb5bd");
                color:@(Model.status == "Pending" ? "#212529" : "#fff");font-weight:600;">
                @Model.status
            </span>
        </p>
        <p><strong>Total Amount:</strong> <span class="fw-bold">@Model.total_amount</span></p>
        <p><strong>Shipping Address:</strong> @Model.shipping_address</p>
        <hr />
        <div class="seller-info-box mt-4 p-3 rounded shadow-sm" style="background:#f5f7fa;border:1.5px solid #e3e6ed;max-width:400px;">
            <div class="d-flex align-items-center mb-2">
                <i class="fas fa-store me-2" style="color:#1976d2;font-size:1.3em;"></i>
                <span style="font-size:1.15em;font-weight:700;color:#1976d2;letter-spacing:0.5px;">Seller Info</span>
            </div>
            <div class="mb-2">
                <i class="fas fa-id-badge me-2" style="color:#607d8b;"></i>
                <strong>Seller ID:</strong> <span class="text-muted">@(Model.OrderItems.FirstOrDefault()?.product?.seller_id ?? "-")</span>
            </div>
            <div>
                <i class="fas fa-user me-2" style="color:#607d8b;"></i>
                <strong>Seller Name:</strong> <span class="text-muted">@(Model.OrderItems.FirstOrDefault()?.product?.Seller?.UserName ?? "-")</span>
            </div>
        </div>
    </div>
</div>

<h4>Products</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var item in Model.OrderItems)
    {
        <tr>
            <td>@item.product?.name</td>
            <td>@item.quantity</td>
            <td>@item.unit_price</td>
            <td>
                <span class="badge" style="font-size:1em;padding:7px 16px;border-radius:8px;letter-spacing:0.5px;
                    background:@(item.status == "Pending" ? "#ffc107" : item.status == "Processing" ? "#0dcaf0" : item.status == "Shipped" ? "#0d6efd" : item.status == "Delivered" ? "#198754" : item.status == "Cancelled" ? "#dc3545" : "#adb5bd");
                    color:@(item.status == "Pending" ? "#212529" : "#fff");font-weight:600;">
                    @item.status
                </span>
            </td>
            <td>
                @if (item.product != null && item.product.seller_id == sellerId)
                {
                    <form asp-action="ChangeOrderItemStatus" method="post" style="display:inline;">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="orderItemId" value="@item.id" />
                        <select name="newStatus" class="form-select form-select-sm d-inline w-auto">
                            @if (item.status == "Pending")
                            {
                                <option value="Pending" selected="selected">Pending</option>
                            }
                            else
                            {
                                <option value="Pending">Pending</option>
                            }
                            @if (item.status == "Processing")
                            {
                                <option value="Processing" selected="selected">Processing</option>
                            }
                            else
                            {
                                <option value="Processing">Processing</option>
                            }
                            @if (item.status == "Shipped")
                            {
                                <option value="Shipped" selected="selected">Shipped</option>
                            }
                            else
                            {
                                <option value="Shipped">Shipped</option>
                            }
                            @if (item.status == "Delivered")
                            {
                                <option value="Delivered" selected="selected">Delivered</option>
                            }
                            else
                            {
                                <option value="Delivered">Delivered</option>
                            }
                            @if (item.status == "Cancelled")
                            {
                                <option value="Cancelled" selected="selected">Cancelled</option>
                            }
                            else
                            {
                                <option value="Cancelled">Cancelled</option>
                            }
                        </select>
                        <button type="submit" class="btn btn-primary btn-sm ms-1">Update</button>
                    </form>
                }
            </td>
        </tr>
    }
    </tbody>
</table>

<div class="mt-3">
    <a asp-action="Orders" class="btn btn-secondary">Back to Orders</a>
</div> 