@model Final_project.Models.order

@{
    ViewData["Title"] = "Order Details";
    var sellerId = User.Identity.Name ?? "test-seller-id";
}

<h2>Order Details</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}
<div class="card mb-3">
    <div class="card-body">
        <h5>Order ID: <span class="badge bg-primary">@Model.id</span></h5>
        <p><strong>Date:</strong> @Model.order_date?.ToString("yyyy-MM-dd")</p>
        <p><strong>Customer:</strong> @Model.Buyer?.UserName</p>
        <p><strong>Status:</strong> <span class="badge bg-info">@Model.status</span></p>
        <p><strong>Total Amount:</strong> <span class="fw-bold">@Model.total_amount</span></p>
        <p><strong>Shipping Address:</strong> @Model.shipping_address</p>
        <hr />
        <h6>Seller Info</h6>
        <ul class="list-unstyled mb-0">
            <li><strong>Seller ID:</strong> <span class="text-muted">@(Model.OrderItems.FirstOrDefault()?.product?.seller_id ?? "-")</span></li>
            <li><strong>Seller Name:</strong> <span class="text-muted">@(Model.OrderItems.FirstOrDefault()?.product?.Seller?.UserName ?? "-")</span></li>
        </ul>
    </div>
</div>

<h4>Products</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var item in Model.OrderItems)
    {
        <tr>
            <td>@item.product?.name</td>
            <td>@item.quantity</td>
            <td>@item.unit_price</td>
            <td>
                <span class="badge bg-info">@item.status</span>
            </td>
            <td>
                @if (item.product != null && item.product.seller_id == sellerId)
                {
                    <form asp-action="ChangeOrderItemStatus" method="post" style="display:inline;">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="orderItemId" value="@item.id" />
                        <select name="newStatus" class="form-select form-select-sm d-inline w-auto">
                            @if (item.status == "Pending")
                            {
                                <option value="Pending" selected="selected">Pending</option>
                            }
                            else
                            {
                                <option value="Pending">Pending</option>
                            }
                            @if (item.status == "Processing")
                            {
                                <option value="Processing" selected="selected">Processing</option>
                            }
                            else
                            {
                                <option value="Processing">Processing</option>
                            }
                            @if (item.status == "Shipped")
                            {
                                <option value="Shipped" selected="selected">Shipped</option>
                            }
                            else
                            {
                                <option value="Shipped">Shipped</option>
                            }
                            @if (item.status == "Delivered")
                            {
                                <option value="Delivered" selected="selected">Delivered</option>
                            }
                            else
                            {
                                <option value="Delivered">Delivered</option>
                            }
                            @if (item.status == "Cancelled")
                            {
                                <option value="Cancelled" selected="selected">Cancelled</option>
                            }
                            else
                            {
                                <option value="Cancelled">Cancelled</option>
                            }
                        </select>
                        <button type="submit" class="btn btn-primary btn-sm ms-1">Update</button>
                    </form>
                }
            </td>
        </tr>
    }
    </tbody>
</table>

<div class="mt-3">
    <a asp-action="Orders" class="btn btn-secondary">Back to Orders</a>
</div> 