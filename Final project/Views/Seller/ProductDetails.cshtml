@model Final_project.Models.product
@{
    ViewData["Title"] = "Product Details";
    var mainImage = Model.product_images?.FirstOrDefault(pi => pi.image_type == "main" || pi.is_primary == true);
    var subImages = Model.product_images?.Where(pi => pi.image_type == "sub" && pi.is_primary != true).ToList() ?? new List<product_image>();
}

<h2>Product Details</h2>
<div class="card mb-4">
    <div class="row g-0">
        <div class="col-md-4">

            <div class="main-image-container mb-3">
                @if (mainImage != null)
                {
                    <img id="mainImage" src="@mainImage.image_url" class="img-fluid rounded" alt="Main Product Image" style="width:400px;height:400px;object-fit:cover;border-radius:12px;display:block;margin:auto;" />
                }
                else if (Model.product_images != null && Model.product_images.Any())
                {
                    <img id="mainImage" src="@Model.product_images.First().image_url" class="img-fluid rounded" alt="Product Image" style="width:400px;height:400px;object-fit:cover;border-radius:12px;display:block;margin:auto;" />
                }
                else
                {
                    <div class="d-flex align-items-center justify-content-center bg-light rounded" style="width:400px;height:400px;margin:auto;">
                        <span class="text-muted">No Image</span>
                    </div>
                }
            </div>
            

            @if (Model.product_images != null && Model.product_images.Count() > 1)
            {
                <div class="thumbnail-container">
                    <div class="row">
                        @foreach (var image in Model.product_images.Take(5))
                        {
                            <div class="col-3 mb-2">
                                <img src="@image.image_url" 
                                     class="img-thumbnail thumbnail-image" 
                                     style="height: 60px; width: 100%; object-fit: cover; cursor: pointer;"
                                     onclick="changeMainImage('@image.image_url')"
                                     alt="Product Thumbnail" />
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
        <div class="col-md-8">
            <div class="card-body">
                <h4 class="card-title">@Model.name</h4>
                <div class="mb-3">
                    <strong>Description:</strong>
                    <div class="border rounded p-2 bg-light">@Model.description</div>
                </div>
                <ul class="list-unstyled">
                    <li><strong>Price:</strong> <span class="fw-bold">@Model.price</span></li>
                    @if (Model.discount_price.HasValue)
                    {
                        <li><strong>Discount Price:</strong> <span class="fw-bold text-success">@Model.discount_price</span></li>
                    }
                    <li><strong>Stock Quantity:</strong> @Model.stock_quantity</li>
                    <li><strong>Brand:</strong> @Model.Brand</li>
                    <li><strong>SKU:</strong> @Model.sku</li>
                    <li><strong>Category:</strong> @Model.category_id</li>
                    <li><strong>Colors:</strong> @Model.Colors</li>
                    <li><strong>Sizes:</strong> @Model.Sizes</li>
                    <li><strong>Created At:</strong> @Model.created_at?.ToString("yyyy-MM-dd")</li>
                    <li><strong>Active:</strong> @(Model.is_active == true ? "Yes" : "No")</li>
                    <li><strong>Approved:</strong> @(Model.is_approved == true ? "Approved" : "Pending")</li>
                </ul>
                <hr />
                <h6>Seller Info</h6>
                <ul class="list-unstyled mb-0">
                    <li><strong>Seller ID:</strong> <span class="text-muted">@Model.seller_id</span></li>
                    <li><strong>Seller Name:</strong> <span class="text-muted">@Model.Seller?.UserName ?? "-"</span></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="mt-3">
    <a asp-action="EditProduct" asp-route-id="@Model.id" class="btn btn-warning">
        <i class="fas fa-edit"></i> Edit
    </a>
    <a asp-action="MyProducts" class="btn btn-secondary">Back to My Products</a>
</div>

<script>
function changeMainImage(imageUrl) {
    document.getElementById('mainImage').src = imageUrl;
}
</script> 